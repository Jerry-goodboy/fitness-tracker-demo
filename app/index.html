<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
        <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <script src="bower_components/moment/min/moment.min.js"></script>
        <script src="js/formatters.js"></script>
        <link rel="import" href="elements.html" />
        <style is="custom-style" include="app-theme"></style>
    </head>
    <body unresolved class="fullbleed">
        <template is="dom-bind" id="app">
            <iron-ajax auto url="[[dataUrl(week)]]" handle-as="json" last-response="{{weekData}}" on-error="ajaxError" />
            <iron-ajax auto url="/data/user.json" handle-as="json" last-response="{{user}}" />

            <neon-animated-pages id="pages" selected="[[selected]]" attr-for-selected="name">
                <summary-view week-data="[[weekData]]" user="[[user]]" name="summary"></summary-view>
                <workouts-view week-data="[[weekData]]" user="[[user]]" name="details"></workouts-view>
            </neon-animated-pages>
            <paper-toast id="toast"></paper-toast>
        </template>

        <script>
            // Configure Moment.js to start the week on Monday.
            moment.locale('en', {
                 week: {
                     dow: 1
                 }
            });

            var app = document.querySelector('#app');
            app.selected = 'summary';
            app.week = 39;
            app.prevWeek = app.week;

            app.dataUrl = function(week) {
                return 'data/week-' + week + '.json';
            };

            app.ajaxError = function(err) {
                this.$.toast.text = 'Sorry, no data available for week ' + app.week + '.';
                this.$.toast.show();
                app.week = app.prevWeek;
            };

            app.addEventListener('dom-change', function() {
                this.$.pages.addEventListener('neon-animation-finish', function(e) {
                    if (e.detail.toPage.pageTransitionFinished) {
                        e.detail.toPage.pageTransitionFinished();
                    }
                });
            });
            document.addEventListener('navigate', function(e) {
                app.selected = e.detail;
            });
            document.addEventListener('next-week', function(e) {
                app.prevWeek = app.week;
                app.week++;
            });
            document.addEventListener('prev-week', function(e) {
                app.prevWeek = app.week;
                app.week--;
            });

        </script>
    </body>
</html>
