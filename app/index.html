<!doctype html>
<html manifest="manifest.appcache">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Fitness Tracker</title>
        <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <script src="bower_components/moment/min/moment.min.js"></script>
        <script src="js/formatters.js"></script>
        <link rel="import" href="elements.html" />
        <style is="custom-style" include="app-theme"></style>

        <!-- Chrome -->
        <meta name="theme-color" content="#a7ffeb" />
        <meta name="mobile-web-app-capable" content="yes" />
        <link rel="icon" sizes="192x192" href="resources/app-icon-192x192.png" />

        <!-- iOS -->
        <link rel="apple-touch-icon" href="resources/app-icon-192x192.png" />
        <meta name="apple-mobile-web-app-capable" content="yes">
    </head>
    <body unresolved class="fullbleed">
        <template is="dom-bind" id="app">
            <iron-ajax auto url="[[dataUrl(week)]]" handle-as="json" last-response="{{weekData}}" on-error="ajaxError" /></iron-ajax>
            <iron-ajax auto url="data/user.json" handle-as="json" last-response="{{user}}"></iron-ajax>
            <paper-dialog id="about" modal>
                <iron-icon class="big" src="resources/app-icon-192x192.png"></iron-icon>
                <h1>Fitness Tracker</h1>
                <p>
                    This is a demo application built with <a href="https://elements.polymer-project.org/">Polymer Elements</a>,
                    <a href="https://vaadin.com/components">Vaadin Components</a> and <a href="https://vaadin.com/charts">Vaadin Charts</a>.
                </p>
                <p>
                    Fork the project on <a href="https://github.com/tehapo/fitness-tracker-demo">GitHub</a>.
                </p>
                <button dialog-confirm autofocus>OK</button>
            </paper-dialog>

            <neon-animated-pages id="pages" selected="[[selected]]" attr-for-selected="name">
                <summary-view week-data="[[weekData]]" user="[[user]]" name="summary"></summary-view>
                <workouts-view week-data="[[weekData]]" user="[[user]]" name="details"></workouts-view>
            </neon-animated-pages>
            <paper-toast id="toast"></paper-toast>
        </template>

        <script>
            // Configure Moment.js to start the week on Monday.
            moment.locale('en', {
                 week: {
                     dow: 1
                 }
            });

            var app = document.querySelector('#app');
            app.selected = 'summary';
            app.week = 40;
            app.prevWeek = app.week;

            app.dataUrl = function(week) {
                return 'data/week-' + week + '.json';
            };

            app.ajaxError = function(err) {
                this.$.toast.text = 'Sorry, no data available for week ' + app.week + '.';
                this.$.toast.show();
                app.week = app.prevWeek;
            };

            app.addEventListener('dom-change', function() {
                this.$.pages.addEventListener('neon-animation-finish', function(e) {
                    if (e.detail.toPage.pageTransitionFinished) {
                        e.detail.toPage.pageTransitionFinished();
                    }
                });
            });
            document.addEventListener('navigate', function(e) {
                app.selected = e.detail;
            });
            document.addEventListener('about', function(e) {
                app.$.about.open();
            });
            document.addEventListener('next-week', function(e) {
                app.prevWeek = app.week;
                app.week++;
            });
            document.addEventListener('prev-week', function(e) {
                app.prevWeek = app.week;
                app.week--;
            });

        </script>
    </body>
</html>
